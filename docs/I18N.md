# Guide d’utilisation de l’i18n – Frontend MindfulSpace

> Ce document explique rapidement ce qui a été mis en place pour la gestion multilingue (FR/EN) dans le frontend Next.js, et comment l’utiliser dans vos pages et composants.

---

## 1. Ce qui a été mis en place

### 1.1. Structure des routes

- Toutes les pages passent maintenant par un segment dynamique de langue :

  - `src/app/[locale]/...`
  - Ex. : `/fr/resources`, `/en/member/dashboard`, `/fr/member/seance/respiration`

- Les locales supportées sont définies dans `src/i18n/config.ts` :

  - `type Locale = "fr" | "en";`
  - `export const locales: Locale[] = ["fr", "en"];`
  - `export const defaultLocale: Locale = "fr";`
  - Helper : `isLocale(value: string): value is Locale`

### 1.2. Dictionnaires de traduction

- Les textes sont centralisés dans :

  - `src/i18n/fr.ts`
  - `src/i18n/en.ts`

- Chaque fichier exporte un objet regroupant des *namespaces* :

  ```ts
  export const fr = {
    footer: {
      deployMessage: "...",
      cookiePolicy: "...",
    },
    navbar: {
      resources: "...",
      // ...
    },
    // ...
  };
  ```

- Les namespaces déjà utilisés par le projet : `footer`, `navbar`, `publicHome`, `resourcesPage`, `offlinePage`, `cookiesPolicyPage`, `contactPage`, `formationPage`, `breathingSession`, `moodSession`, `sessionRecap`, `tipSession`, `domainSleep`, `domainExercise`, `domainMeditation`, etc.

> ⚠️ Toute nouvelle chaîne visible par l’utilisateur devrait idéalement être ajoutée dans ces dictionnaires (FR **et** EN).

### 1.3. Context & hooks

- `TranslationProvider` (dans `src/i18n/TranslationContext.tsx`) est utilisé dans `app/[locale]/layout.tsx` pour fournir un contexte de traduction à tous les composants enfants.
- Deux façons de consommer les traductions :
  - **Server Components** : `getDictionary(locale)`
  - **Client Components** : `useTranslations("namespace")`

### 1.4. Autres éléments liés à l’i18n

- `LanguageSwitcher` : petit composant dans les layouts `(public)` et `(member)` pour changer `fr`/`en` en gardant la même route.
- `MainNavbar` : navbar unique (public/member) avec les labels traduits via le namespace `navbar`.
- Les liens internes utilisent systématiquement la locale : `href={\`/${locale}/resources\`}` plutôt que `href="/resources"`.

---

## 2. Server Component vs Client Component

### 2.1. Server Component : `getDictionary` + accès par propriété

Usage typique pour une page server-side, ex. `src/app/[locale]/(public)/contact/page.tsx` :

```ts
import { getDictionary } from "@/i18n/get-dictionary";
import { isLocale, defaultLocale, type Locale } from "@/i18n/config";

export default async function ContactPage({
  params,
}: {
  params: Promise<{ locale: string }>;
}) {
  const { locale: rawLocale } = await params;
  const locale: Locale = isLocale(rawLocale) ? rawLocale : defaultLocale;

  const dict = await getDictionary(locale);
  const t = dict.contactPage; // t est un objet

  return (
    <main>
      <h1>{t.title}</h1>
      <p>{t.subtitle}</p>
    </main>
  );
}
```

**À retenir :**

- `getDictionary(locale)` **ne s’utilise que côté serveur** (pas de `use client`).
- On accède aux traductions par **propriété** : `t.title`, `t.subtitle`, etc.  
  **PAS** `t("title")` dans ce cas.

---

### 2.2. Client Component : `useTranslations("namespace")` + appel fonctionnel

Usage typique pour un composant client, ex. une page interactive ou une navbar :

```ts
"use client";

import { usePathname } from "next/navigation";
import { useTranslations } from "@/i18n/TranslationContext";
import { isLocale, defaultLocale, type Locale } from "@/i18n/config";

export default function ExampleClientComponent() {
  const pathname = usePathname();
  const raw = pathname.split("/")[1] || defaultLocale;
  const locale: Locale = isLocale(raw) ? raw : defaultLocale;

  const t = useTranslations("resourcesPage"); // t est une fonction

  return (
    <div>
      <h1>{t("heroTitle")}</h1>
      <p>{t("heroSubtitle")}</p>
    </div>
  );
}
```

**À retenir :**

- On utilise `useTranslations("namespace")` uniquement dans un composant marqué `"use client"`.
- `t` est une **fonction** : on appelle `t("clé")`.
- La locale est déterminée à partir de l’URL (`/fr/...` ou `/en/...`) avec `usePathname()`.

---

## 3. Comment ajouter une nouvelle page traduite ?

### Étape 1 – Créer le namespace dans les dictionnaires

1. Dans `src/i18n/fr.ts` :

   ```ts
   examplePage: {
     title: "Titre en français",
     intro: "Texte d’introduction en français",
   },
   ```

2. Dans `src/i18n/en.ts` :

   ```ts
   examplePage: {
     title: "Title in English",
     intro: "Intro text in English",
   },
   ```

### Étape 2 – Server Component (page classique)

```ts
import { getDictionary } from "@/i18n/get-dictionary";
import { isLocale, defaultLocale, type Locale } from "@/i18n/config";

export default async function ExamplePage({
  params,
}: {
  params: Promise<{ locale: string }>;
}) {
  const { locale: rawLocale } = await params;
  const locale: Locale = isLocale(rawLocale) ? rawLocale : defaultLocale;

  const dict = await getDictionary(locale);
  const t = dict.examplePage;

  return (
    <main>
      <h1>{t.title}</h1>
      <p>{t.intro}</p>
    </main>
  );
}
```

### Étape 3 – Client Component (si hooks / localStorage / events)

```ts
"use client";

import { useTranslations } from "@/i18n/TranslationContext";
import { usePathname } from "next/navigation";
import { isLocale, defaultLocale, type Locale } from "@/i18n/config";

export default function ExampleClientPage() {
  const pathname = usePathname();
  const raw = pathname.split("/")[1] || defaultLocale;
  const locale: Locale = isLocale(raw) ? raw : defaultLocale;

  const t = useTranslations("examplePage");

  return (
    <main>
      <h1>{t("title")}</h1>
      <p>{t("intro")}</p>
    </main>
  );
}
```

---

## 4. Bonnes pratiques & pièges courants

- ✅ **Toujours** ajouter les nouvelles clés dans **FR et EN** en même temps.
- ✅ Utiliser des namespaces explicites : `contactPage`, `resourcesPage`, `moodSession`, etc.
- ✅ Pour les routes : toujours inclure la locale dans les `href` :
  - `href={\`/${locale}/member/dashboard\`}`
- ❌ Éviter les chaînes en dur dans les JSX (en français ou en anglais).
- ❌ Ne pas appeler `useTranslations` dans un Server Component.
- ❌ Ne pas utiliser `t("clé")` quand on a obtenu `t` via `getDictionary` (dans ce cas c’est un simple objet).

---
