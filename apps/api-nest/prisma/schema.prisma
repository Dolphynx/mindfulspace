generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum MeditationMode {
  TIMER
  AUDIO
  VIDEO
  VISUAL
}

enum MeditationSessionSource {
  GUIDED
  MANUAL
  QUICK_TIMER
}

enum MeditationVisualType {
  BREATHING_WAVE
  LOTUS_OPENING
  CIRCLE_PULSE
}

// Home page test graph
model TestData {
  id          String   @id @default(uuid())
  metricName  String
  label       String
  metricValue Int
  createdAt   DateTime @default(now())
}

model SleepSession {
  id          String   @id @default(uuid())
  hours       Int
  quality     Int?
  dateSession DateTime
  dateCreated DateTime @default(now())

  user   User?   @relation(fields: [userId], references: [id])
  userId String?
}

model MeditationSession {
  id String @id @default(cuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  // Origine de la séance
  source MeditationSessionSource

  // TYPE
  meditationTypeId String
  meditationType   MeditationType @relation("SessionActualType", fields: [meditationTypeId], references: [id])

  // Contenu GUIDED (optionnel)
  meditationContentId String?
  meditationContent   MeditationContent? @relation(fields: [meditationContentId], references: [id])

  startedAt       DateTime?
  endedAt         DateTime?
  durationSeconds Int

  moodBefore Int?
  moodAfter  Int?
  notes      String?

  createdAt DateTime @default(now())

  @@index([userId])
  @@index([meditationTypeId])
  @@index([meditationContentId])
  @@map("meditation_session")
}

model MeditationType {
  id        String  @id @default(cuid())
  slug      String  @unique
  //name        String
  //description String?
  isActive  Boolean @default(true)
  sortOrder Int?

  contents MeditationContent[] @relation("ContentDefaultType")
  sessions MeditationSession[] @relation("SessionActualType")

  @@map("meditation_type")
}

model MeditationContent {
  id          String  @id @default(cuid())
  title       String
  description String?

  // Mode : TIMER / AUDIO / VIDEO / VISUAL
  mode MeditationMode

  // Type par défaut pour les sessions lancées par ce contenu
  defaultMeditationTypeId String
  defaultMeditationType   MeditationType @relation("ContentDefaultType", fields: [defaultMeditationTypeId], references: [id])

  // Durées (suggestions / bornes)
  defaultDurationSeconds Int?
  minDurationSeconds     Int?
  maxDurationSeconds     Int?

  // Media unique (audio OU vidéo), optionnel si TIMER/VISUAL
  mediaUrl String? // ex: "/audio/respiration.mp3" ou "https://youtu.be/..."

  isActive  Boolean @default(true)
  sortOrder Int?

  // Relations
  visualConfig MeditationVisualConfig?
  sessions     MeditationSession[] // sessions GUIDED
  programItems MeditationProgramItem[] // utilisé dans des programmes

  @@map("meditation_content")
}

model MeditationVisualConfig {
  id String @id @default(cuid())

  meditationContentId String            @unique
  meditationContent   MeditationContent @relation(fields: [meditationContentId], references: [id])

  visualType MeditationVisualType
  configJson Json // ex: { "breathIn": 5, "breathOut": 5, "cycles": 12 }

  @@map("meditation_visual_config")
}

/**
 * Programmes de méditation (séquences de MeditationContent)
 */
model MeditationProgram {
  id          String  @id @default(cuid())
  title       String
  description String?
  isActive    Boolean @default(true)
  isPremium   Boolean @default(false)
  sortOrder   Int?

  items     MeditationProgramItem[]
  resources Resource[] // ressources qui pointent vers ce programme

  @@map("meditation_program")
}

model MeditationProgramItem {
  id                  String @id @default(cuid())
  meditationProgramId String
  meditationContentId String
  order               Int

  meditationProgram MeditationProgram @relation(fields: [meditationProgramId], references: [id])
  meditationContent MeditationContent @relation(fields: [meditationContentId], references: [id])

  @@map("meditation_program_item")
}

model WorkoutSession {
  id          String   @id @default(uuid())
  quality     Int?
  dateSession DateTime
  dateCreated DateTime @default(now())

  exerciceSessions ExerciceSession[]

  user   User?   @relation(fields: [userId], references: [id])
  userId String?
}

model ExerciceType {
  id          String @id @default(uuid())
  name        String @unique
  Description String

  exerciceSessions ExerciceSession[]
}

model ExerciceSession {
  workoutSessionId String
  exerciceTypeId   String

  workoutSession WorkoutSession @relation(fields: [workoutSessionId], references: [id])
  exerciceType   ExerciceType   @relation(fields: [exerciceTypeId], references: [id])

  repetitionCount Int

  @@id([workoutSessionId, exerciceTypeId])
}

model User {
  id          String  @id @default(cuid())
  email       String  @unique
  displayName String?

  workoutSessions    WorkoutSession[]
  sleepSessions      SleepSession[]
  meditationSessions MeditationSession[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/**
 * model Objective { ... }
 */

enum ObjectiveFrequency {
  DAILY
  WEEKLY
  MONTHLY
}

enum ObjectiveDurationUnit {
  DAY
  WEEK
  MONTH
}

enum ResourceType {
  ARTICLE
  VIDEO
  MEDITATION_PROGRAM
  WORKOUT_PROGRAM
  GUIDE
}

model ResourceCategory {
  id        String  @id @default(uuid())
  name      String
  slug      String  @unique
  iconEmoji String? // utile ??

  resources Resource[]
}

model ResourceTag {
  id   String @id @default(uuid())
  name String
  slug String @unique

  resources ResourceTagOnResource[]
}

model Resource {
  id          String       @id @default(uuid())
  title       String
  slug        String       @unique
  summary     String
  content     String
  type        ResourceType
  isPremium   Boolean      @default(false)
  isFeatured  Boolean      @default(false)
  authorName  String?
  readTimeMin Int?
  externalUrl String?

  categoryId String
  category   ResourceCategory @relation(fields: [categoryId], references: [id])

  // Lien optionnel vers un programme de méditation
  meditationProgramId String?
  meditationProgram   MeditationProgram? @relation(fields: [meditationProgramId], references: [id])

  // (WorkoutProgram => à mettre en place)
  tags ResourceTagOnResource[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([title])
  @@index([summary])
}

model ResourceTagOnResource {
  resourceId String
  tagId      String

  resource Resource    @relation(fields: [resourceId], references: [id])
  tag      ResourceTag @relation(fields: [tagId], references: [id])

  @@id([resourceId, tagId])
}
